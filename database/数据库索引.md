## 索引类型
### B-Tree 索引
InnoDB使用B+树来实现索引. 叶子节点中即存储相应的数据行, 叶子节点通过后继指针相连. 这意味着所有的值是按顺序存储的. 每个叶子节点到根节点的高度相同, 意味着每条数据依据索引查询的效率是相同的. B+树索引适用于一下匹配类型:
  - 全值匹配
    全值匹配指和索引中的所有列进行匹配
  - 匹配最左前缀
    匹配索引的第一列
  - 匹配列前缀
    只匹配某一列的值的开头部分
  - 匹配范围值
  - 精确匹配某一列并范围匹配另外一列
  - 只访问索引的查询
    查询只需要访问索引, 无须访问数据行
BTree索引的限制:
  - 如果不从索引的最左列开始查找, 则无法使用索引.
  - 不能跳过索引中的列
  - 当查询中有某个列的范围查询, 则右边所有列无法使用索引优化查找.
### hash 索引
hash 索引基于哈希表实现, 只有精准匹配索引的所有列的查询才有效. hash索引计算所有索引的列的hash code, hash表中保存指向每个数据行的指针. 
因为hash 索引是计算的hash code, 所以hash索引的精准查找效率非常快. 但由于结构的限制, hash表有致命的缺点:
  - 不支持索引部分列的匹配查找.
  - 只支持等值查找, 不支持范围查找.
  - hash冲突的存在会导致遍历桶内链表. 如果hash冲突很多, 则索引维护操作的代价也会很高.
> InnoDB存储引擎有"自适应哈希索引"的功能. 当其注意到某些索引值被使用地非常频繁, 则会在BTree索引的基础上再建立一个hash索引.
### 空间数据索引(R-Tree)
空间索引从所有维度来所以数据. 查询时可以有效地使用任意维度来组合查询. PostgreSQL对这类索引查询提供较好的解决方案.
### 全文索引
全文索引用于查找文本中的关键词. 全文搜索和其他几类索引的匹配方式完全不同.
### 索引的优点
- 索引大大减小了服务需要扫描的数据量
- 索引可以有效帮助服务器避免排序(BTree索引)和临时表
- 所以可以将随机I/O变为顺序I/O
  
  > 索引并不在所有情况下都是高效的. 只有当所以帮助存储引擎快速查找到记录带了的好处大于其带来的额外工作时, 索引才是必要的.
## 高效的索引策略
### 前缀索引
如果需要索引很长的字符串, 索引会变得很大很慢. 这时如果只使用字符串开始的部分子串, 则可以大大节约索引空间, 提高索引效率. 
这里有个重要概念, 就是`索引的选择性`. 索引的选择性指不重复的索引值和数据表记录总数的比值. 索引的选择性越高, 则查询效率越高.
在选择前缀索引的子串大小时, 要充分考虑到索引的选择性大小. 太小的子串可能导致索引的选择性太低, 而太大的子串则失去了前缀索引的意义, 不能起到节约所以空间的作用.
### 多列索引
在多个列上分别建立单列索引大部分情况下并不能提到查询性能. 有时候, 需要在多个列上建立联合索引.
在多个列上建立索引时, 要充分考虑索引列的顺序, 因为列的顺序涉及到Btree索引查询的匹配类型和查询限制. 一个关键的经验是: **将选择性高的索引放在索引的前列**.
### 聚簇索引
聚簇索引时InnoDB默认的数据存储方式. 在聚簇索引中, 数据行实际放置在索引的叶子页中, 相邻数据行放在一起. 一张表只能存在一个聚簇索引. 因为聚簇索引的存储结构, InnoDB要求每个表都有一个主键列, 如果没有定义, InnoDB会选择一个唯一的非空索引代替. 如果没有这样的索引, 则InnoDB会定义一个隐式主键来作为聚簇索引.
**优点:**
- 把相关的数据保存在一起.
- 数据访问更快. 聚簇索引使数据保存在索引树中, 可以直接访问到的数据行, 而不是用指针代替做二次读取.
**缺点:**
- 聚簇索引数据结构最大限度提高了I/O密集型应用的性能, 但如果所有数据都在内存中, 则失去了其访问苏幅度优势.
- 插入速度严重依赖插入顺序. 按主键的插入顺序是速度最快的.
- 聚簇所以的维护代价很高, 因为B+数据的结构限制, 删除或插入数据是, 可能导致索引节点的分裂或聚合, 或者叶子节点的分裂或聚合. 在此过程中, 会强迫特别的数据行到对应的位置上.
- 使二级索引的可能比较大, 因为二级索引的叶子节点包含了主键的值.
> MyISAM 存储引擎采用非聚簇的结构, 即无论主键索引还是叶子索引, 其子节点中存储的都是对应数据行的指针, 需要进行地址解析才能获取到真实的数据行. MyISAM按照按照插入顺序将数据行顺序存储在磁盘上.

在InnoDB中, 如果没有数据列需要聚集, 应该使用代理主键即与数据列无关的数据. 最常见的方法是使用`AUTO_INCREMENT`自增列. 最好避免使用随机的聚簇索引, 会使插入行为变得完全随机, 还会使叶子页变得稀疏不规则, 导致数据碎片.
> 顺序的`AUTO_INCREMENT`主键并不是完美的解决方案, 当在高并发的插入场景中, 会导致主键上界的争用, 因为数据的插入都发生在这里. 因为`AUTO_INCREMENT`锁机制的存在, 会使插入效率变慢.

### 覆盖索引
覆盖索引是指索引中包含了所有查询的数据行, 使查询仅仅依靠索引直接获取列的数据, 不需要读取数据行.